<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ì‹œ(ë¬¼ë¦¬)ì—ì´ì…˜ ê´€ë¦¬ì í˜ì´ì§€</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="./image/favicon.png">
  <style>
    :root{
      --bg:#020617;
      --panel:#050b1c;
      --ink:#e5e7eb;
      --muted:#9ca3af;
      --accent:#4f46e5;
      --accent-soft:#6366f1;
      --danger:#ef4444;
      --ok:#22c55e;
      --line:#1f2937;
      --radius:14px;
      --shadow:0 18px 40px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font:14px/1.6 system-ui,"Pretendard","Noto Sans KR",sans-serif;
      background:
        radial-gradient(900px 600px at 0% 0%,rgba(79,70,229,.35),transparent 55%),
        radial-gradient(900px 600px at 100% 100%,rgba(14,165,233,.25),transparent 55%),
        #020617;
      color:var(--ink);
      padding:24px 16px 40px;
      overflow-x: hidden; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
    }
    .wrap{
      max-width:960px;
      margin:0 auto;
      position: relative;
      z-index: 10; /* ë°°ê²½ ìºë¦­í„°ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
    }
    h1{
      margin:0 0 6px;
      font-size:22px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    h1 span.logo{
      width:28px;
      height:28px;
      border-radius:10px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      background:#111827;
      border:1px solid rgba(148,163,255,.4);
      font-size:16px;
    }
    .subtitle{
      margin:0 0 20px;
      font-size:13px;
      color:var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card{
      background:rgba(15,23,42,.9);
      border-radius:var(--radius);
      border:1px solid rgba(55,65,81,.9);
      box-shadow:var(--shadow);
      padding:18px 18px 16px;
      margin-bottom:16px;
      backdrop-filter: blur(4px); /* ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ íš¨ê³¼ ì‚´ì§ */
    }
    .card h2{
      margin:0 0 10px;
      font-size:16px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      background:rgba(79,70,229,.14);
      border:1px solid rgba(129,140,248,.6);
      color:#c7d2fe;
    }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:4px;
    }
    input{
      width:100%;
      padding:7px 9px;
      border-radius:8px;
      border:1px solid #374151;
      background:#020617;
      color:var(--ink);
      font-size:13px;
      margin-bottom:8px;
    }
    input:focus{
      outline:none;
      border-color:var(--accent-soft);
      box-shadow:0 0 0 1px rgba(99,102,241,.6);
    }
    .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .row > div{
      flex:1 1 180px;
    }
    button{
      border:none;
      border-radius:999px;
      padding:8px 14px;
      font-size:13px;
      cursor:pointer;
      background:linear-gradient(180deg,var(--accent-soft),#312e81);
      color:#e5e7eb;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    button.secondary{
      background:transparent;
      border:1px solid rgba(148,163,255,.7);
      color:#e5e7eb;
    }
    button.danger{
      background:linear-gradient(180deg,#ef4444,#b91c1c);
      border:none;
      color:#fee2e2;
    }
    button.small{
      padding:4px 10px;
      font-size:12px;
    }
    button:disabled{
      opacity:.5;
      cursor:default;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }
    .status-line{
      margin-top:8px;
      font-size:12px;
    }
    .status-ok{color:var(--ok);}
    .status-err{color:var(--danger);}
    .lock-card{
      max-width:420px;
      margin:40px auto 0;
      text-align:left;
    }
    .lock-title{
      font-size:15px;
      margin:0 0 4px;
    }
    .lock-sub{
      margin:0 0 14px;
      font-size:13px;
      color:var(--muted);
    }
    .pill{
      display:inline-flex;
      padding:2px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,255,.5);
      font-size:11px;
      color:#c7d2fe;
      margin-left:4px;
    }
    .mt-8{margin-top:8px;}
    .mt-4{margin-top:4px;}
    .flex-between{
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:center;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:12px;
      margin-top:8px;
    }
    th,td{
      padding:6px 8px;
      border-bottom:1px solid #1f2937;
    }
    th{
      text-align:left;
      color:#9ca3af;
      font-weight:500;
      background:#050816;
      position:sticky;
      top:0;
      z-index:1;
    }
    tbody tr:nth-child(even){
      background:rgba(15,23,42,.6);
    }
    .tag{
      display:inline-flex;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid #374151;
      font-size:11px;
      color:#9ca3af;
    }
    .small{
      font-size:11px;
      color:#6b7280;
    }
    .scroll{
      max-height:280px;
      overflow:auto;
      margin-top:6px;
      border-radius:10px;
      border:1px solid #1f2937;
    }
    .csv-table-wrap{
      max-height:260px;
      overflow:auto;
      border-radius:10px;
      border:1px solid #1f2937;
      margin-top:8px;
    }
    .mono{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    /* ìˆ¨ê¹€ ì²˜ë¦¬ìš© ìœ í‹¸ë¦¬í‹° */
    .hidden { display: none !important; }

    /* ===== [NEW] ë°°ê²½ ì¥ì‹ (ì‹œë¬¼ì´ë“¤) ìŠ¤íƒ€ì¼ ===== */
    .bg-deco-container {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; /* í´ë¦­ í†µê³¼ */
      z-index: 0; /* wrap(10)ë³´ë‹¤ ë’¤ì— */
      overflow: hidden;
    }
    .simuli-float {
      position: absolute;
      width: 140px;
      opacity: 0.85;
      filter: drop-shadow(0 0 15px rgba(100,120,255,0.2));
      animation: floatAni 6s ease-in-out infinite;
    }
    /* ì™¼ìª½ ë°°ì¹˜ */
    .s-left-1 { top: 15%; left: 5%; animation-delay: 0s; width: 150px; }
    .s-left-2 { top: 60%; left: 8%; animation-delay: 2s; width: 130px; }
    
    /* ì˜¤ë¥¸ìª½ ë°°ì¹˜ (í¬ê¸° ìˆ˜ì •ë¨) */
    .s-right-1 { top: 20%; right: 6%; animation-delay: 1s; width: 168px; } /* ì „ê¸°: 140px * 1.2 */
    .s-right-2 { top: 65%; right: 5%; animation-delay: 3s; width: 225px; } /* ì–‘ì: 150px * 1.5 */

    @keyframes floatAni {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(2deg); }
    }

    /* í™”ë©´ì´ ì¢ì•„ì§€ë©´(1400px ì´í•˜) ë°°ê²½ ìºë¦­í„° ìˆ¨ê¹€ (ë³¸ë¬¸ ê°€ë¦¼ ë°©ì§€) */
    @media (max-width: 1400px) {
      .bg-deco-container { display: none; }
    }
  </style>
</head>
<body>

  <div class="bg-deco-container">
    <img src="./image/ì—­í•™ì‹œë¬¼ì´.png" class="simuli-float s-left-1" alt="ì—­í•™">
    <img src="./image/ì—´ì‹œë¬¼ì´.png" class="simuli-float s-left-2" alt="ì—´">
    <img src="./image/ì „ê¸°ì‹œë¬¼ì´.png" class="simuli-float s-right-1" alt="ì „ê¸°">
    <img src="./image/ì–‘ìì‹œë¬¼ì´.png" class="simuli-float s-right-2" alt="ì–‘ì">
  </div>

  <div class="wrap">
    <h1>
      <span class="logo">âš›ï¸</span>
      ì‹œ(ë¬¼ë¦¬)ì—ì´ì…˜ ê´€ë¦¬ì
      <span class="pill">Admin Mode</span>
    </h1>
    <div class="subtitle">
      <span>Firebase Firestore ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ í˜ì´ì§€</span>
      <button id="btn-logout" class="secondary small hidden">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div class="card lock-card" id="lock-card">
      <p class="lock-title">ê´€ë¦¬ì ë¡œê·¸ì¸</p>
      <p class="lock-sub">
        ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.<br>
        (UID: <span class="mono">fwlMPfvz...</span> ê³„ì •ë§Œ ì ‘ì† ê°€ëŠ¥)
      </p>
      
      <label for="admin-email">ê´€ë¦¬ì ì•„ì´ë”” (ë˜ëŠ” ì´ë©”ì¼)</label>
      <input type="text" id="admin-email" placeholder="ì˜ˆ: admin" />

      <label for="admin-pass">ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="admin-pass" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
      
      <div class="flex-between mt-8">
        <button id="btn-admin-login">ë¡œê·¸ì¸</button>
      </div>
      <p class="status-line" id="admin-lock-status"></p>
    </div>

    <div id="admin-main" class="hidden">

      <div class="card">
        <h2>ğŸ§‘â€ğŸ“ ë‹¨ì¼ í•™ìƒ ê³„ì • ìƒì„± <span class="badge">1ëª… ì¶”ê°€</span></h2>
        <p class="hint">
          <strong>ì£¼ì˜:</strong> ê³„ì •ì„ ìƒì„±í•˜ë©´ ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í’€ë¦¬ê³  ìƒˆ í•™ìƒ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ë©ë‹ˆë‹¤. 
          ìƒì„± í›„ ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ ëª©ë¡ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div class="row mt-8">
          <div>
            <label for="new-id">í•™ìƒ ì•„ì´ë””</label>
            <input type="text" id="new-id" placeholder="ì˜ˆ: s1A_01" />
          </div>
          <div>
            <label for="new-pass">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="new-pass" placeholder="ìµœì†Œ 6ìë¦¬" />
          </div>
          <div>
            <label for="new-pass2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input type="password" id="new-pass2" placeholder="ë‹¤ì‹œ ì…ë ¥" />
          </div>
        </div>

        <div class="row mt-4">
          <div>
            <label for="auto-prefix">ID ì ‘ë‘ì–´ (ì„ íƒ)</label>
            <input type="text" id="auto-prefix" placeholder="ì˜ˆ: s1A_" />
          </div>
          <div>
            <label for="auto-start">ì‹œì‘ ë²ˆí˜¸</label>
            <input type="number" id="auto-start" value="1" />
          </div>
          <div>
            <label for="auto-digits">ë²ˆí˜¸ ìë¦¬ìˆ˜</label>
            <input type="number" id="auto-digits" value="2" />
          </div>
        </div>
        <div class="flex-between mt-4">
          <div style="display:flex;gap:8px;align-items:center;">
            <button type="button" class="secondary small" id="btn-auto-id">ID ìë™ ìƒì„±</button>
            <span class="small">ì˜ˆ: s1A_01</span>
          </div>
          <button id="btn-create">ê³„ì • ìƒì„±</button>
        </div>
        <p class="status-line" id="create-status"></p>
      </div>

      <div class="card">
        <h2>ğŸ“¥ CSV ì¼ê´„ ê³„ì • ìƒì„± <span class="badge">ëŒ€ëŸ‰ ì¶”ê°€</span></h2>
        <p class="hint">
          CSV í˜•ì‹: <span class="mono">id,password</span> (ë¹„ë²ˆ ì—†ìœ¼ë©´ ìë™)<br>
          ê³„ì • ìƒì„± ì§„í–‰ ì¤‘ì—ëŠ” ê´€ë¦¬ì ê¶Œí•œì´ ì„ì‹œë¡œ í•´ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div class="row mt-8">
          <div>
            <label for="csv-file">CSV íŒŒì¼ ì„ íƒ</label>
            <input type="file" id="csv-file" accept=".csv,text/csv" />
          </div>
          <div>
            <label>&nbsp;</label>
            <button type="button" class="secondary small" id="btn-clear-csv">ëª©ë¡ ë¹„ìš°ê¸°</button>
          </div>
        </div>
        <div class="csv-table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:40px;">#</th>
                <th>ì•„ì´ë””(ID)</th>
                <th>ë¹„ë°€ë²ˆí˜¸</th>
                <th style="width:120px;">ìƒíƒœ</th>
              </tr>
            </thead>
            <tbody id="csv-tbody">
              <tr><td colspan="4" class="small">CSV íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</td></tr>
            </tbody>
          </table>
        </div>
        <div class="flex-between mt-8">
          <button type="button" id="btn-bulk-create">ê³„ì • ì¼ê´„ ìƒì„±</button>
          <p class="small" id="bulk-summary">ì½ì–´ì˜¨ í–‰: 0</p>
        </div>
        <p class="status-line" id="bulk-status"></p>
      </div>

      <div class="card">
        <h2>ğŸ“Š ì ìˆ˜ ë° ì‚¬ìš©ì ëª©ë¡</h2>
        <div class="flex-between">
          <p class="hint">
            Firestore <span class="tag">scores</span> ì»¬ë ‰ì…˜ ë°ì´í„°
          </p>
          <button class="secondary" id="btn-refresh">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="scroll">
          <table>
            <thead>
              <tr>
                <th style="width:40px;">#</th>
                <th>ì•„ì´ë””(ID)</th>
                <th style="width:80px;">ì ìˆ˜</th>
                <th style="width:140px;">UID (ì•ë¶€ë¶„)</th>
              </tr>
            </thead>
            <tbody id="score-tbody">
              <tr><td colspan="4" class="small">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ [ëª©ë¡ ìƒˆë¡œê³ ì¹¨]ì„ ëˆ„ë¥´ì„¸ìš”.</td></tr>
            </tbody>
          </table>
        </div>
        <p class="status-line" id="list-status"></p>
      </div>

      <div class="card">
        <h2>ğŸ“¢ ê±´ì˜í•¨ ìˆ˜ì‹  ëª©ë¡</h2>
        <div class="flex-between">
          <p class="hint">
            í•™ìƒ ì˜ê²¬ í™•ì¸ ë° ì‚­ì œ
          </p>
          <button class="secondary" id="btn-refresh-sugg">ê±´ì˜í•¨ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="scroll">
          <table style="min-width: 600px;">
            <colgroup>
              <col style="width: 50px;">
              <col style="width: 140px;">
              <col style="width: 100px;">
              <col style="width: auto;">
              <col style="width: 70px;">
            </colgroup>
            <thead>
              <tr>
                <th>#</th>
                <th>ë‚ ì§œ</th>
                <th>ë³´ë‚¸ í•™ìƒ</th>
                <th>ì œëª© / ë‚´ìš©</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody id="sugg-tbody">
              <tr><td colspan="5" class="small">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ [ê±´ì˜í•¨ ìƒˆë¡œê³ ì¹¨]ì„ ëˆ„ë¥´ì„¸ìš”.</td></tr>
            </tbody>
          </table>
        </div>
        <p class="status-line" id="sugg-status"></p>
      </div>

    </div>
  </div>

  <script type="module">
    // ===== 1. Firebase SDK ë¡œë“œ =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword, // ë¡œê·¸ì¸ìš©
      onAuthStateChanged,         // ìƒíƒœê°ì§€ìš©
      signOut
    } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      getDocs,
      collection,
      query,
      orderBy,
      limit,
      deleteDoc 
    } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

    // ===== 2. Firebase ì„¤ì • =====
    const firebaseConfig = {
      apiKey: "AIzaSyCO36JgPpNz8swADxTMVJUFVALWM5o171w",
      authDomain: "simulation-67cd3.firebaseapp.com",
      projectId: "simulation-67cd3",
      storageBucket: "simulation-67cd3.appspot.com",
      messagingSenderId: "615983461615",
      appId: "1:615983461615:web:002e07bcea878eb6d5571a",
      measurementId: "G-9RGN7LYE5W"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ===== 3. ê´€ë¦¬ì UID ë° DOM ìš”ì†Œ =====
    // ğŸ”¥ ì•„ë˜ UIDì™€ ì¼ì¹˜í•˜ëŠ” ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì•¼ë§Œ ë°ì´í„° ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    const ADMIN_UID = "fwlMPfvz8ITNN5ajAuhnwoplqGB3";

    const lockCard = document.getElementById("lock-card");
    const adminMain = document.getElementById("admin-main");
    const btnLogout = document.getElementById("btn-logout");

    const adminEmailInput = document.getElementById("admin-email");
    const adminPassInput = document.getElementById("admin-pass");
    const adminLockStatus = document.getElementById("admin-lock-status");
    const btnAdminLogin = document.getElementById("btn-admin-login");

    // ===== 4. ë¡œê·¸ì¸ ë° ê¶Œí•œ ì²´í¬ ë¡œì§ =====

    // (1) ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
    btnAdminLogin.addEventListener("click", async () => {
      let emailInput = adminEmailInput.value.trim();
      const pw = adminPassInput.value.trim();

      if (!emailInput || !pw) {
        adminLockStatus.textContent = "ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.";
        adminLockStatus.className = "status-line status-err";
        return;
      }

      // âœ¨ [í•µì‹¬] ì•„ì´ë””ë§Œ ì…ë ¥ ì‹œ ìë™ìœ¼ë¡œ ë„ë©”ì¸ ì¶”ê°€
      let finalEmail = emailInput;
      if (!finalEmail.includes("@")) {
        finalEmail += "@myapp.local"; 
      }

      adminLockStatus.textContent = "ë¡œê·¸ì¸ ì¤‘...";
      adminLockStatus.className = "status-line";

      try {
        const cred = await signInWithEmailAndPassword(auth, finalEmail, pw);
        if (cred.user.uid !== ADMIN_UID) {
          throw new Error("ê´€ë¦¬ì ê³„ì •ì´ ì•„ë‹™ë‹ˆë‹¤. (UID ë¶ˆì¼ì¹˜)");
        }
        // ì„±ê³µ ì‹œ onAuthStateChangedì—ì„œ í™”ë©´ ì „í™˜ë¨
      } catch (err) {
        console.error(err);
        adminLockStatus.textContent = `ë¡œê·¸ì¸ ì‹¤íŒ¨ (${emailInput}): ` + err.message;
        adminLockStatus.className = "status-line status-err";
        await signOut(auth);
      }
    });

    // (2) ì—”í„°í‚¤ ì²˜ë¦¬
    adminPassInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") btnAdminLogin.click();
    });

    // (3) ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
    btnLogout.addEventListener("click", async () => {
      await signOut(auth);
      window.location.reload(); // ê¹”ë”í•˜ê²Œ ìƒˆë¡œê³ ì¹¨
    });

    // (4) ì¸ì¦ ìƒíƒœ ë³€í™” ê°ì§€ (í™”ë©´ ì „í™˜ í•µì‹¬)
    onAuthStateChanged(auth, (user) => {
      if (user && user.uid === ADMIN_UID) {
        // ê´€ë¦¬ì ì¸ì¦ ì„±ê³µ
        lockCard.classList.add("hidden");
        adminMain.classList.remove("hidden");
        btnLogout.classList.remove("hidden");
        adminLockStatus.textContent = "";
        console.log("ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”: ", user.email);
      } else {
        // ë¹„ë¡œê·¸ì¸ ë˜ëŠ” ì¼ë°˜ ìœ ì €(í•™ìƒ ìƒì„± ì§í›„ ë“±)
        lockCard.classList.remove("hidden");
        adminMain.classList.add("hidden");
        btnLogout.classList.add("hidden");
        
        // ë¡œê·¸ì¸ ë˜ì–´ìˆëŠ”ë° ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´?
        if (user) {
          adminLockStatus.textContent = `í˜„ì¬ ë¡œê·¸ì¸ëœ ê³„ì •(${user.email || user.uid})ì€ ê´€ë¦¬ìê°€ ì•„ë‹™ë‹ˆë‹¤.`;
          adminLockStatus.className = "status-line status-err";
        }
      }
    });

    // ===== 5. ê¸°ëŠ¥: ID ìë™ ìƒì„± =====
    const newIdInput = document.getElementById("new-id");
    const newPassInput = document.getElementById("new-pass");
    const newPass2Input = document.getElementById("new-pass2");
    const btnCreate = document.getElementById("btn-create");
    const createStatus = document.getElementById("create-status");
    const autoPrefixInput = document.getElementById("auto-prefix");
    const autoStartInput = document.getElementById("auto-start");
    const autoDigitsInput = document.getElementById("auto-digits");
    const btnAutoId = document.getElementById("btn-auto-id");

    let autoCounter = 0;

    function padNumber(n, digits){
      const s = String(n);
      if (s.length >= digits) return s;
      return "0".repeat(digits - s.length) + s;
    }

    btnAutoId.addEventListener("click", () => {
      const prefix = autoPrefixInput.value || "";
      let startNum = parseInt(autoStartInput.value, 10);
      const digits = Math.max(1, parseInt(autoDigitsInput.value, 10) || 1);

      if (!autoCounter) autoCounter = isNaN(startNum) ? 1 : startNum;
      else autoCounter++;

      const id = prefix + padNumber(autoCounter, digits);
      newIdInput.value = id;
      createStatus.textContent = `ìë™ ID: ${id}`;
      createStatus.className = "status-line";
    });

    // ===== 6. ê¸°ëŠ¥: ë‹¨ì¼ ê³„ì • ìƒì„± =====
    btnCreate.addEventListener("click", async () => {
      const id = newIdInput.value.trim();
      const pw1 = newPassInput.value;
      const pw2 = newPass2Input.value;

      createStatus.textContent = "";
      if (!id) return alert("IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      if (pw1.length < 6) return alert("ë¹„ë°€ë²ˆí˜¸ 6ìë¦¬ ì´ìƒ í•„ìˆ˜");
      if (pw1 !== pw2) return alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜");

      const email = id + "@myapp.local";
      btnCreate.disabled = true;
      createStatus.textContent = "ìƒì„± ì¤‘...";

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, pw1);
        
        await setDoc(doc(db, "users", cred.user.uid), { ID: id });
        await setDoc(doc(db, "scores", cred.user.uid), { ID: id, score: 0 });

        createStatus.textContent = `ìƒì„± ì™„ë£Œ: ${id} (ê´€ë¦¬ì ì¬ë¡œê·¸ì¸ í•„ìš”)`;
        createStatus.className = "status-line status-ok";
        newIdInput.value = "";
        newPassInput.value = "";
        newPass2Input.value = "";
        
        alert("ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\në³´ì•ˆìƒ ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•´ì œë˜ì—ˆìœ¼ë‹ˆ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
        await signOut(auth); 
      } catch (err) {
        console.error(err);
        createStatus.textContent = "ì˜¤ë¥˜: " + err.message;
        createStatus.className = "status-line status-err";
      } finally {
        btnCreate.disabled = false;
      }
    });

    // ===== 7. ê¸°ëŠ¥: CSV ì¼ê´„ ìƒì„± =====
    const csvFileInput = document.getElementById("csv-file");
    const csvTbody = document.getElementById("csv-tbody");
    const btnBulkCreate = document.getElementById("btn-bulk-create");
    const btnClearCsv = document.getElementById("btn-clear-csv");
    const bulkSummary = document.getElementById("bulk-summary");
    const bulkStatus = document.getElementById("bulk-status");

    let csvRows = [];
    
    function resetCsvTable(){
      csvRows = [];
      csvTbody.innerHTML = `<tr><td colspan="4" class="small">CSV íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</td></tr>`;
      bulkSummary.textContent = "ì½ì–´ì˜¨ í–‰: 0";
      bulkStatus.textContent = "";
    }
    btnClearCsv.addEventListener("click", resetCsvTable);

    function randomPassword(len=8){
      const c = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789";
      let o=""; for(let i=0;i<len;i++) o+=c.charAt(Math.floor(Math.random()*c.length));
      return o;
    }

    csvFileInput.addEventListener("change", () => {
      const file = csvFileInput.files?.[0];
      if (!file) return resetCsvTable();

      const reader = new FileReader();
      reader.onload = (e) => {
        const text = String(e.target.result || "");
        const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
        if(!lines.length) return resetCsvTable();

        let start = 0;
        if(lines[0].toLowerCase().includes("id")) start = 1;

        csvRows = [];
        csvTbody.innerHTML = "";
        
        for(let i=start; i<lines.length; i++){
          const parts = lines[i].split(",");
          const id = (parts[0]||"").trim();
          let pw = (parts[1]||"").trim();
          if(!id) continue;
          
          if(!pw || pw.length<6) pw = randomPassword(8);

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${csvRows.length+1}</td>
            <td>${id}</td>
            <td>${pw}</td>
            <td class="small">ëŒ€ê¸°</td>
          `;
          csvTbody.appendChild(tr);
          
          csvRows.push({ id, pw, statusEl: tr.querySelector("td:last-child") });
        }
        bulkSummary.textContent = `ì½ì–´ì˜¨ í–‰: ${csvRows.length}`;
      };
      reader.readAsText(file);
    });

    btnBulkCreate.addEventListener("click", async () => {
      if(!csvRows.length) return alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
      if(!confirm("ì¼ê´„ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆê¹Œ?\nì¤‘ê°„ì— ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•´ì œë  ìˆ˜ ìˆìœ¼ë‹ˆ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.")) return;

      btnBulkCreate.disabled = true;
      let s=0, f=0;

      for(let i=0; i<csvRows.length; i++){
        const row = csvRows[i];
        const email = row.id + "@myapp.local";
        
        row.statusEl.textContent = "ìƒì„± ì¤‘...";
        try {
          await signOut(auth); 
          const cred = await createUserWithEmailAndPassword(auth, email, row.pw);
          await setDoc(doc(db, "users", cred.user.uid), { ID: row.id });
          await setDoc(doc(db, "scores", cred.user.uid), { ID: row.id, score: 0 });
          
          row.statusEl.textContent = "ì„±ê³µ";
          row.statusEl.className = "status-ok small";
          s++;
        } catch(e) {
          console.error(e);
          row.statusEl.textContent = "ì‹¤íŒ¨: " + e.code;
          row.statusEl.className = "status-err small";
          f++;
        }
      }
      
      bulkStatus.textContent = `ì™„ë£Œ: ì„±ê³µ ${s}, ì‹¤íŒ¨ ${f}. (ê´€ë¦¬ì ì¬ë¡œê·¸ì¸ í•„ìš”)`;
      alert("ì¼ê´„ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
      await signOut(auth);
      btnBulkCreate.disabled = false;
    });

    // ===== 8. ê¸°ëŠ¥: ì ìˆ˜ ëª©ë¡ ì¡°íšŒ =====
    const btnRefresh = document.getElementById("btn-refresh");
    const tbody = document.getElementById("score-tbody");
    const listStatus = document.getElementById("list-status");

    btnRefresh.addEventListener("click", async () => {
      if (!auth.currentUser || auth.currentUser.uid !== ADMIN_UID) {
         return alert("ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      }

      tbody.innerHTML = `<tr><td colspan="4" class="small">ë¡œë”© ì¤‘...</td></tr>`;
      listStatus.textContent = "";

      try {
        const q = query(collection(db, "scores"), orderBy("score", "desc"), limit(200));
        const snap = await getDocs(q);

        if (snap.empty) {
          tbody.innerHTML = `<tr><td colspan="4" class="small">ë°ì´í„° ì—†ìŒ</td></tr>`;
          return;
        }

        let html = "";
        let i = 0;
        snap.forEach(d => {
          i++;
          const val = d.data();
          html += `
            <tr>
              <td>${i}</td>
              <td>${val.ID || "-"}</td>
              <td>${val.score ?? 0}</td>
              <td class="small">${d.id.substring(0,10)}...</td>
            </tr>
          `;
        });
        tbody.innerHTML = html;
        listStatus.textContent = `ì´ ${i}ëª… ì¡°íšŒë¨`;
        listStatus.className = "status-line status-ok";
      } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td colspan="4" class="small">ë¡œë“œ ì‹¤íŒ¨</td></tr>`;
        listStatus.textContent = "ê¶Œí•œ ì˜¤ë¥˜: " + err.message;
        listStatus.className = "status-line status-err";
      }
    });

    // ===== 9. ê¸°ëŠ¥: ê±´ì˜í•¨ ì¡°íšŒ ë° ì‚­ì œ =====
    const btnRefreshSugg = document.getElementById("btn-refresh-sugg");
    const suggTbody = document.getElementById("sugg-tbody");
    const suggStatus = document.getElementById("sugg-status");

    function formatTime(ts) {
      if(!ts) return "-";
      const d = ts.toDate();
      return `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${d.getMinutes()}`;
    }

    async function loadSuggestions() {
      if (!auth.currentUser || auth.currentUser.uid !== ADMIN_UID) {
         return alert("ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      }
      suggTbody.innerHTML = `<tr><td colspan="5" class="small">ë¡œë”© ì¤‘...</td></tr>`;
      
      try {
        const q = query(collection(db, "suggestions"), orderBy("date", "desc"));
        const snap = await getDocs(q);

        if (snap.empty) {
          suggTbody.innerHTML = `<tr><td colspan="5" class="small">ê±´ì˜ ì‚¬í•­ ì—†ìŒ</td></tr>`;
          suggStatus.textContent = "ë°ì´í„° ì—†ìŒ";
          return;
        }

        let html = "";
        let i = 0;
        snap.forEach(d => {
          i++;
          const data = d.data();
          html += `
            <tr>
              <td>${i}</td>
              <td class="small">${formatTime(data.date)}</td>
              <td style="font-weight:bold;color:#a5b4fc">${data.writerID || "ìµëª…"}</td>
              <td>
                <div style="font-weight:bold">${data.title || "(ë¬´ì œ)"}</div>
                <div class="small">${data.content || ""}</div>
              </td>
              <td>
                <button class="danger small btn-del-sugg" data-id="${d.id}">ì‚­ì œ</button>
              </td>
            </tr>
          `;
        });
        suggTbody.innerHTML = html;
        suggStatus.textContent = `ì´ ${i}ê±´`;
        suggStatus.className = "status-line status-ok";

        document.querySelectorAll(".btn-del-sugg").forEach(btn => {
          btn.addEventListener("click", async (e) => {
            if(!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            const docId = e.target.dataset.id;
            try {
              await deleteDoc(doc(db, "suggestions", docId));
              alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
              loadSuggestions();
            } catch(err) {
              alert("ì‚­ì œ ì‹¤íŒ¨: " + err.message);
            }
          });
        });

      } catch (err) {
        console.error(err);
        suggTbody.innerHTML = `<tr><td colspan="5" class="small">ë¡œë“œ ì‹¤íŒ¨</td></tr>`;
        suggStatus.textContent = "ê¶Œí•œ ì˜¤ë¥˜: " + err.message;
        suggStatus.className = "status-line status-err";
      }
    }

    btnRefreshSugg.addEventListener("click", loadSuggestions);

  </script>
</body>
</html>